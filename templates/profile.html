{% extends "base.html" %}

{% block title %}Profile - MoneyWise{% endblock %}

{% block content %}
<div class="profile-page">
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1><i class="fas fa-user"></i> Profile & Settings</h1>
        </div>
        
        <div class="profile-grid">
            <!-- Profile Information -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-user-circle"></i> Account Information</h3>
                </div>
                <div class="card-body">
                    <div class="profile-info">
                        <div class="info-item">
                            <label>Username</label>
                            <p>{{ current_user.username }}</p>
                        </div>
                        
                        <div class="info-item">
                            <label>Email</label>
                            <p>{{ current_user.email }}</p>
                        </div>
                        
                        <div class="info-item">
                            <label>Currency</label>
                            <p>{{ current_user.currency }}</p>
                        </div>
                        
                        <div class="info-item">
                            <label>Member Since</label>
                            <p>{{ current_user.created_at.strftime('%B %d, %Y') }}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Statistics -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-chart-bar"></i> Your Statistics</h3>
                </div>
                <div class="card-body">
                    <div class="stats-list">
                        <div class="stat-item">
                            <i class="fas fa-wallet stat-icon"></i>
                            <div class="stat-details">
                                <p class="stat-label">Current Balance</p>
                                <p class="stat-value">â‚¹{{ "%.2f"|format(current_user.get_balance()) }}</p>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <i class="fas fa-arrow-up stat-icon income"></i>
                            <div class="stat-details">
                                <p class="stat-label">Total Income (All Time)</p>
                                <p class="stat-value income">â‚¹{{ "%.2f"|format(current_user.get_total_income()) }}</p>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <i class="fas fa-arrow-down stat-icon expense"></i>
                            <div class="stat-details">
                                <p class="stat-label">Total Expenses (All Time)</p>
                                <p class="stat-value expense">â‚¹{{ "%.2f"|format(current_user.get_total_expenses()) }}</p>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <i class="fas fa-receipt stat-icon"></i>
                            <div class="stat-details">
                                <p class="stat-label">Total Transactions</p>
                                <p class="stat-value">{{ current_user.transactions|length }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Actions -->
        <div class="profile-actions">
            <button class="btn btn-outline" onclick="openChangePasswordModal()">
                <i class="fas fa-key"></i> Change Password
            </button>
            
            <button class="btn btn-outline" onclick="openEditProfileModal()">
                <i class="fas fa-edit"></i> Edit Profile
            </button>
            
            <a href="{{ url_for('logout') }}" class="btn btn-danger">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
        </div>
    </div>
</div>

<!-- Change Password Modal -->
<div id="passwordModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-key"></i> Change Password</h2>
            <button class="close-modal" onclick="closePasswordModal()">&times;</button>
        </div>
        
        <form method="POST" action="#">
            <div class="modal-body">
                <div class="form-group">
                    <label for="current_password">Current Password *</label>
                    <input 
                        type="password" 
                        id="current_password" 
                        name="current_password" 
                        class="form-control" 
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label for="new_password">New Password *</label>
                    <input 
                        type="password" 
                        id="new_password" 
                        name="new_password" 
                        class="form-control" 
                        required
                        minlength="8"
                    >
                    <small class="form-text">At least 8 characters</small>
                </div>
                
                <div class="form-group">
                    <label for="confirm_password">Confirm New Password *</label>
                    <input 
                        type="password" 
                        id="confirm_password" 
                        name="confirm_password" 
                        class="form-control" 
                        required
                        minlength="8"
                    >
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closePasswordModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Update Password
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Profile Modal -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-user-edit"></i> Edit Profile</h2>
            <button class="close-modal" onclick="closeEditModal()">&times;</button>
        </div>
        
        <form method="POST" action="#">
            <div class="modal-body">
                <div class="form-group">
                    <label for="email">Email *</label>
                    <input 
                        type="email" 
                        id="email" 
                        name="email" 
                        class="form-control" 
                        value="{{ current_user.email }}"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label for="currency">Currency *</label>
                    <select id="currency" name="currency" class="form-control" required>
                        <option value="USD" {% if current_user.currency == 'USD' %}selected{% endif %}>USD - US Dollar ($)</option>
                        <option value="EUR" {% if current_user.currency == 'EUR' %}selected{% endif %}>EUR - Euro (â‚¬)</option>
                        <option value="GBP" {% if current_user.currency == 'GBP' %}selected{% endif %}>GBP - British Pound (Â£)</option>
                        <option value="INR" {% if current_user.currency == 'INR' %}selected{% endif %}>INR - Indian Rupee (â‚¹)</option>
                        <option value="JPY" {% if current_user.currency == 'JPY' %}selected{% endif %}>JPY - Japanese Yen (Â¥)</option>
                        <option value="AUD" {% if current_user.currency == 'AUD' %}selected{% endif %}>AUD - Australian Dollar (A$)</option>
                        <option value="CAD" {% if current_user.currency == 'CAD' %}selected{% endif %}>CAD - Canadian Dollar (C$)</option>
                    </select>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeEditModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function openChangePasswordModal() {
        document.getElementById('passwordModal').style.display = 'flex';
    }
    
    function closePasswordModal() {
        document.getElementById('passwordModal').style.display = 'none';
    }
    
    function openEditProfileModal() {
        document.getElementById('editModal').style.display = 'flex';
    }
    
    function closeEditModal() {
        document.getElementById('editModal').style.display = 'none';
    }
    
    // Close modals when clicking outside
    window.onclick = function(event) {
        const passwordModal = document.getElementById('passwordModal');
        const editModal = document.getElementById('editModal');
        
        if (event.target === passwordModal) {
            closePasswordModal();
        }
        if (event.target === editModal) {
            closeEditModal();
        }
    }
</script>
{% endblock %}